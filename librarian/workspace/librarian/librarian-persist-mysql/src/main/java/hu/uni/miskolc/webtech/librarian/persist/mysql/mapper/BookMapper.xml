<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="hu.uni.miskolc.webtech.librarian.persist.mysql.mapper.BookMapper">


	<resultMap type="Book" id="BookRM">
		<id property="bookId" column="bookId" javaType="int" jdbcType="INTEGER"/>
		<result property="title" column="title" />
		<collection property="genres" column="bookId" select="queryGenresOfBook"/>
		<collection property="authors" column="bookId" select="queryAuthorsOfBook"/>
		<!-- <result property="genres" javaType="Genre" column="bookId" select="queryGenresOfBook" /> -->
	
		<!-- <association property="genres" javaType="Genre">
			<association property="genres" column="bookId" select="queryGenresOfBook" />
		</association>
		<association property="authors" javaType="Author">
			<association property="authros" column="bookId" select="queryAuthorsOfBook" />
		</association>
		-->
	</resultMap>

	<select id="selectBooks" resultMap="BookRM">
		select * from book;
	</select>

	<select id="queryGenresOfBook" parameterType="int" resultType="Genre">
		select genre from genre where book = #{bookId};
	</select>

	<select id="queryAuthorsOfBook" parameterType="int" resultType="Author">
		select * from author where authorId in (select authorId from
		bookAuthor where bookId = #{bookId});
	</select>

	<!-- <select id="selectAuthors" resultMap="AuthorResultMap"> select * from 
		author; </select> <select id="selectAuthorsByName" resultMap="AuthorResultMap"> 
		select * from author where authorName like #{name}; </select> <select id="selectAuthorsByNationality" 
		resultMap="AuthorResultMap"> select * from author where nationality = #{nationality}; 
		</select> <select id="selectAuthorById" resultType="Author"> select * from 
		author where authorId=#{authorId}; </select> <insert id="recordAuthor"> insert 
		into author(authorName, nationality, birthDate) values(#{name},#{nationality},#{birthDate}); 
		</insert> <update id="updateAuthor" parameterType="Author"> update author 
		set authorName = #{author.name}, nationality = #{author.nationality}, birthDate 
		= #{author.birthDate} where authorId = #{author.authorID}; </update> <delete 
		id="deleteAuthor" parameterType="Author"> delete author where authorId = 
		#{author.authorID}; </delete> -->

</mapper>